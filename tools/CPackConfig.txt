set(CPACK_PACKAGE_NAME "lava")
set(CPACK_PACKAGE_DESCRIPTION "Large Scale Automated Vulnerability Addition (LAVA) is a tool designed to automatically inject synthetic vulnerabilities into C source code for testing and evaluation purposes.")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "LAVA enables researchers and developers to study and improve vulnerability detection tools by planting controlled memory errors in C programs.")
set(CPACK_PACKAGE_VENDOR "PANDA")
set(CPACK_DEBIAN_PACKAGE_MAINTAINER "andrewquijano@nyu.edu")
set(CPACK_DEBIAN_PACKAGE_ARCHITECTURE amd64)

if(${CMAKE_SYSTEM_PROCESSOR} STREQUAL "aarch64")
	set(CPACK_DEBIAN_PACKAGE_ARCHITECTURE "arm64")
endif()

set(CPACK_STRIP_FILES false)

# Compression settings
set(CPACK_DEBIAN_PACKAGE_COMPRESSION_TYPE "xz") # Use xz compression for smaller package size

# Licensing information
set(CPACK_DEBIAN_PACKAGE_LICENSE "GPL-2.0") # Specify the license type

# Dependencies
set(CPACK_DEBIAN_PACKAGE_DEPENDS 
    "bc, 
    build-essential, 
    clang-tools-11,
    libclang-11-dev,
    llvm-11-dev,
    cmake, 
    git, 
    inotify-tools, 
    jq,
    libfdt-dev, 
    libjsoncpp-dev, 
    libpq-dev,
    postgresql, 
    socat, 
    ca-certificates, 
    odb, 
    libodbc2, 
    libodb-pgsql-dev, 
    libodb-pgsql-2.4, 
    libzmq3-dev, 
    g++-10, 
    dwarfdump, 
    python3-pip, 
    libprotobuf-dev"
)

# Setting name to match standard file names in apt
set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}_${PROJECT_VERSION}_amd64")

# Priority
set(CPACK_DEBIAN_PACKAGE_PRIORITY "optional") # Set package priority

# Section
set(CPACK_DEBIAN_PACKAGE_SECTION "utils") # Specify the section (e.g., utils, admin, etc.)

# Homepage
set(CPACK_DEBIAN_PACKAGE_HOMEPAGE "https://github.com/panda-re/lava")

# Source ignore files
set(CPACK_SOURCE_IGNORE_FILES "^${CMAKE_BINARY_DIR};/\\\\.gitignore;/\\\\.svn;\\\\.swp$;\\\\.#;/#;.*~")

# Strip binaries
set(CPACK_STRIP_FILES true) # Strip binaries to reduce package size

# Create the triggers file dynamically
file(WRITE "${CMAKE_BINARY_DIR}/triggers" "activate-noawait ldconfig")

# Include the triggers file in the Debian package
set(CPACK_DEBIAN_PACKAGE_CONTROL_EXTRA "${CMAKE_BINARY_DIR}/triggers")

include(CPack)